<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Linux & 操作系统/3-nginx" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">3-nginx | Fall 的笔记本</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://fall-zhang.github.io/my-website/docs/Linux &amp; 操作系统/3-nginx"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="3-nginx | Fall 的笔记本"><meta data-rh="true" name="description" content="Create by fall on 12 Apr 2023"><meta data-rh="true" property="og:description" content="Create by fall on 12 Apr 2023"><link data-rh="true" rel="icon" href="/my-website/./img/favicon.ico"><link data-rh="true" rel="canonical" href="https://fall-zhang.github.io/my-website/docs/Linux &amp; 操作系统/3-nginx"><link data-rh="true" rel="alternate" href="https://fall-zhang.github.io/my-website/docs/Linux &amp; 操作系统/3-nginx" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://fall-zhang.github.io/my-website/docs/Linux &amp; 操作系统/3-nginx" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/my-website/blog/rss.xml" title="Fall 的笔记本 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/my-website/blog/atom.xml" title="Fall 的笔记本 Atom Feed"><link rel="stylesheet" href="/my-website/assets/css/styles.6cc54446.css">
<link rel="preload" href="/my-website/assets/js/runtime~main.81d456e9.js" as="script">
<link rel="preload" href="/my-website/assets/js/main.572a1fc6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_jwCO" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_duDI"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/my-website/"><div class="navbar__logo"><img src="/my-website/./img/logo.svg" alt="My Site Logo" class="themedImage_AzXg themedImage--light_gz6F"><img src="/my-website/./img/logo.svg" alt="My Site Logo" class="themedImage_AzXg themedImage--dark_wbl_"></div><b class="navbar__title text--truncate">Fall 的笔记本</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/my-website/docs/">笔记</a><a class="navbar__item navbar__link" href="/my-website/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Fall-zhang" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_GnfQ"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_drBT colorModeToggle_O6q4"><button class="clean-btn toggleButton_OBl4 toggleButtonDisabled_ne8F" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_eZza"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_Lxcj"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_mA0p"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_l8Aj docsWrapper_KAb6"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_WskB" type="button"></button><div class="docPage_kvSd"><aside class="theme-doc-sidebar-container docSidebarContainer_qwQk"><div class="sidebarViewport_uxQu"><div class="sidebar_uk_I sidebarWithHideableNavbar_roY8"><a tabindex="-1" class="sidebarLogo_B87G" href="/my-website/"><img src="/my-website/./img/logo.svg" alt="My Site Logo" class="themedImage_AzXg themedImage--light_gz6F"><img src="/my-website/./img/logo.svg" alt="My Site Logo" class="themedImage_AzXg themedImage--dark_wbl_"><b>Fall 的笔记本</b></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_l1ou"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/my-website/docs/">README</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/my-website/docs/category/javascript--typescript">JavaScript &amp; TypeScript</a><button aria-label="打开/收起侧边栏菜单「JavaScript &amp; TypeScript」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/my-website/docs/category/大前端知识点">大前端知识点</a><button aria-label="打开/收起侧边栏菜单「大前端知识点」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/HTML和CSS/-- BFC规范">HTML和CSS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/my-website/docs/Linux &amp; 操作系统/1.1-linux">Linux &amp; 操作系统</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/Linux &amp; 操作系统/1.1-linux">1.1-linux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/Linux &amp; 操作系统/1.2-文件系统">1.2-文件系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/Linux &amp; 操作系统/2.1-Shell命令基础">2.1-Shell命令基础</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/Linux &amp; 操作系统/2.2-Shell编写脚本">2.2-Shell编写脚本</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/Linux &amp; 操作系统/2.3-PowerShell">2.3-PowerShell</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/my-website/docs/Linux &amp; 操作系统/3-nginx">3-nginx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/Linux &amp; 操作系统/3.1-wsl">3.1-wsl</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/Linux &amp; 操作系统/4.1-docker">4.1-docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/Linux &amp; 操作系统/4.2-docker compose">4.2-docker compose</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/Linux &amp; 操作系统/4.3-容器的使用">4.3-容器的使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/Linux &amp; 操作系统/5.1-kubernetes">5.1-kubernetes</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/React/-- Hooks">React</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/Vue/-- Vite FAQ">Vue</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/my-website/docs/git工具">git工具</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/npm 包/axios">npm 包</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/my-website/docs/npm 和 nvm 的使用">npm 和 nvm 的使用</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/其它语言/java/-- IDEA 的使用">其它语言</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/my-website/docs/前端环境搭建">前端环境搭建</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/后端/4.2-双向通信">后端</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/my-website/docs/学习资料">学习资料</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/数据库/-- linux环境下的使用">数据库</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/跨平台开发/1.1-移动端适配">跨平台开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/软件工程知识/DevOps">软件工程知识</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/面试-自检/-- HTML、CSS知识点">面试-自检</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_Ia8V"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_YAfL"><div class="docItemContainer_UzBo"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_D4_C" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/my-website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_SGKc"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Linux &amp; 操作系统</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">3-nginx</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_S2ie theme-doc-toc-mobile tocMobile_yUD8"><button type="button" class="clean-btn tocCollapsibleButton_NQ7N">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>3-nginx</h1></header><blockquote><p>Create by <strong>fall</strong> on 12 Apr 2023
Recently revised in 14 Apr 2023</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="nginx">Nginx<a href="#nginx" class="hash-link" aria-label="Nginx的直接链接" title="Nginx的直接链接">​</a></h2><p>开源、高性能、可靠的 web 反向代理服务器。</p><p>高性能：其占用内存少、并发能力强、能支持高达 5w 个并发连接数。</p><p>支持协议：Nginx 仅支持 http、https 和 Email 协议</p><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="应用场景">应用场景<a href="#应用场景" class="hash-link" aria-label="应用场景的直接链接" title="应用场景的直接链接">​</a></h3><p><strong>Web 服务器</strong></p><p>静态资源代理，高性能 WEB 服务器软件，<!-- -->[与 Apache 相比]<!-- -->(###对比 Apache)，它支持更多的并发连接且占用服务器资源少</p><p><strong>反向代理或负载均衡</strong></p><p>负载均衡（将同一个请求转到不同的服务器上），作为 HTTP SERVER 或 DB 等服务器的代理服务器，代理功能相对简单，不及（Haporxy）邮件代理服务软件。</p><p><strong>缓存服务器</strong></p><p>作为缓存服务器，类似于专业的缓存软件</p><blockquote><p>Nginx 和 Node.js 的很多理念类似， HTTP 服务器、事件驱动、异步非阻塞等，且 Nginx 的大部分功能使用 Node.js 也可以实现，Nginx 擅长于底层服务器端资源的处理， Node.js 更擅长上层具体业务逻辑的处理，两者可以完美组合。</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="安装">安装<a href="#安装" class="hash-link" aria-label="安装的直接链接" title="安装的直接链接">​</a></h3><div class="language-bash codeBlockContainer_IW09 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Wktp"><pre tabindex="0" class="prism-code language-bash codeBlock_H6ch thin-scrollbar"><code class="codeBlockLines_j5Bm"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 安装 nginx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> nginx -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 命令查看 Nginx 的安装信息：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rpm</span><span class="token plain"> -ql nginx </span><br></span></code></pre><div class="buttonGroup_MKfy"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_t4q_" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_N8gI"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_InYZ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>目录结构文件夹有两个：</p><div class="language-shell codeBlockContainer_IW09 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Wktp"><pre tabindex="0" class="prism-code language-shell codeBlock_H6ch thin-scrollbar"><code class="codeBlockLines_j5Bm"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Nginx配置文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/nginx/nginx.conf </span><span class="token comment" style="color:#999988;font-style:italic"># nginx 主配置文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/nginx/nginx.conf.default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 可执行程序文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/nginx-upgrade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/sbin/nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># nginx库文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib/systemd/system/nginx.service </span><span class="token comment" style="color:#999988;font-style:italic"># 用于配置系统守护进程</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/lib64/nginx/modules </span><span class="token comment" style="color:#999988;font-style:italic"># Nginx模块目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 帮助文档</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/doc/nginx-1.16.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/doc/nginx-1.16.1/CHANGES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/doc/nginx-1.16.1/README</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/doc/nginx-1.16.1/README.dynamic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/doc/nginx-1.16.1/UPGRADE-NOTES-1.6-to-1.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 静态资源目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/nginx/html/404.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/nginx/html/50x.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/nginx/html/index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 存放Nginx日志文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/var/log/nginx</span><br></span></code></pre><div class="buttonGroup_MKfy"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_t4q_" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_N8gI"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_InYZ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>/etc/nginx/conf.d/</code> 是子配置项存放处， <code>/etc/nginx/nginx.conf</code> 主配置文件会默认把这个文件夹中所有子配置项都引入；</li><li><code>/usr/share/nginx/html/</code> 静态文件都放在这个文件夹，也可以根据你自己的习惯放在其他地方；</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="配置文件">配置文件<a href="#配置文件" class="hash-link" aria-label="配置文件的直接链接" title="配置文件的直接链接">​</a></h3><p>对 Nginx 的优化，主要通过修改 Nginx 配置文件来进行调优。</p><div class="language-nginx codeBlockContainer_IW09 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Wktp"><pre tabindex="0" class="prism-code language-nginx codeBlock_H6ch thin-scrollbar"><code class="codeBlockLines_j5Bm"><span class="token-line" style="color:#393A34"><span class="token plain"># main 段配置信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user  nginx;                        # 指定运行用户，子进程的组，默认即是 nginx（可以不进行设置）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker_processes  auto;             # Nginx 进程数，auto 表示和当前 CPU 物理核心数一样，可用数字表示</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error_log  /var/log/nginx/error.log warn;   # Nginx 的错误日志存放目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error_log  /var/log/nginx/error.log warn;   # Nginx 的访问日志存放目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pid        /var/run/nginx.pid;      # Nginx 服务启动时的 pid 存放位置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker_rlimit_nofile 20480;         # 可以理解成每个 worker 子进程的最大连接数量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker_rlimit_core 20M;             # 记录子进程异常终止后的 core 文件，用于记录分析问题。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker_priority -10;                # 用于调整优先级，linux 默认优先级为 120，120-10=110，110 是最终优先级</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">worker_shutdown_timeout 5s;         # 子进程退出的超时时间。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timer_resolution 100ms;             # Linux 系统中，获取计时器时需要向操作系统内核发送请求，产生开销，因此这个间隔越大开销就越小。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">daemon off;                         # 默认是 on，后台运行模式（生产），off 表示前台，用于调试</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># events 段配置信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">events {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  use epoll;     # 使用 epoll 的 I/O 模型（如果你不知道该使用哪种方法，不用填写，nginx 会自动选择）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  worker_connections 1024;   # 每个子进程允许最大并发数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  accept_mutex on;           # 是否打开负载均衡互斥锁</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># http 段配置信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 配置使用最频繁的部分，代理、缓存、日志定义等绝大多数功能和第三方模块的配置都在这里设置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">http {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 设置日志模式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #                   &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #                   &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default_type mime-type;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  gzip on;    # 采用 gzip 压缩的形式发送数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # gzip_types   # 压缩的文件类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # text/plain text/css </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # application/json </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # application/x-javascript </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # text/xml application/xml </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # application/xml+rss </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # text/javascript</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  access_log  /var/log/nginx/access.log  main;   # Nginx 访问日志存放位置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server_tokens off;        # 关闭错误页面中的版本号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sendfile            on;   # 开启高效传输模式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tcp_nopush          on;   # 减少网络报文段的数量，统一发送头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  tcp_nodelay         on;   # 不缓存数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client_header_timeout 10; # 请求头超时时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client_body_timeout 10;   # 请求体超时时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  keepalive_timeout   30;   # 保持连接的时间，也叫超时时间，单位秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  reset_timeout_connection on; # 清空不响应的客户端连接，释放所占空间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  send_timeout 10;          # 客户端相应超时时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  limit_conn 100; # 为给定的 key 设置最大连接数。100 表示允许每一个 IP 地址最多同时打开有 100 个连接。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  limit_conn_zone 5M; # 用于保存各种 key（比如当前连接数）的共享内存的参数。至少配置能存储 32byte 状态或者 64byte 状态。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  types_hash_max_size 2048;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  include             /etc/nginx/mime.types;      # 文件扩展名与类型映射表（加载子配置项</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default_type        application/octet-stream;   # 默认文件类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # include                         /etc/nginx/conf.d/*.conf;   # </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # server 段配置信息，可以配置多个 server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen       80;       # 配置监听的端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name  localhost;    # 配置的域名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # nginx 每个 location 都是一个匹配目录，nginx 的策略是：访问请求来时，会对访问地址进行解析，从上到下逐个匹配，匹配上就执行对应 location 大括号中的策略，并根据策略对请求作出相应。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # location段配置信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      root   /usr/share/nginx/html;  # 网站根目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      index  index.html index.htm;   # 默认首页文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      deny 172.168.22.11;            # 禁止访问的ip地址，可以为all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      allow 172.168.33.44;           # 允许访问的ip地址，可以为all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location /api/ { # 为路径为 api 的请求设置一个其他的 IP 端口进行调用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass  http://172.168.22.10:1212/api/;  # 修改用户 URL，将 location 后的 URL 从用户 URL 中删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass  http://172.168.22.10:3424;  # 不带 / 意味着不会修改用户 URL，直接透传给上游服务器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  error_page 500 502 503 504 /50x.html;  # 默认 50x 对应的访问页面</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  error_page 400 404 error.html;   # 同上</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_MKfy"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_t4q_" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_N8gI"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_InYZ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="常用内置变量">常用内置变量<a href="#常用内置变量" class="hash-link" aria-label="常用内置变量的直接链接" title="常用内置变量的直接链接">​</a></h3><p>这些内置变量可以在配置的上下文中进行使用</p><table><thead><tr><th>内置变量</th><th>变量功能</th></tr></thead><tbody><tr><td>remote_addr、server_addr</td><td>客户端、服务端 IP 地址</td></tr><tr><td>remote_port、server_port</td><td>客户端、服务端端口</td></tr><tr><td>server_protocol</td><td>服务端协议，协议版本</td></tr><tr><td>scheme</td><td>协议名， http 或 https</td></tr><tr><td>https</td><td>否开启了 https ，是则返回 on ，否则返回空</td></tr><tr><td>connection</td><td>TCP 连接的序号，递增</td></tr><tr><td>connection_request</td><td>TCP 连接当前的请求数量</td></tr><tr><td>request_length</td><td>全部请求的长度，包含请求行、请求头、请求体</td></tr><tr><td>request_method</td><td>请求方法</td></tr><tr><td>request_time</td><td>处理请求已消耗的时间</td></tr><tr><td>request_uri</td><td>请求的 URL，包含参数</td></tr><tr><td>uri</td><td>请求的 URL，不包含参数</td></tr><tr><td>args、query_string</td><td>全部参数字符串</td></tr><tr><td>arg_<!-- -->[name]</td><td>获取特定参数值</td></tr><tr><td>is_args</td><td>URL 中是否有查询字符串（Query String），有的话返回 ？</td></tr><tr><td>host</td><td>请求信息中的 Host</td></tr><tr><td>http_cookie</td><td>获取用户 cookie</td></tr><tr><td>http_user_agent</td><td>用户浏览器（浏览器代理）</td></tr><tr><td>document_root</td><td>由 URI 和 root/alias 规则生成的文件夹路径</td></tr></tbody></table><blockquote><p>其他参数：</p><p>request_filename  访问文件的完整路径
binary_remote_addr  二进制格式的客户端 IP 地址
http_referer  从哪个链接跳转的请求
http_via  每经过一层代理服务器，都会添加相应的信息
limit_rate  返回响应时的速度上限值</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="相关命令">相关命令<a href="#相关命令" class="hash-link" aria-label="相关命令的直接链接" title="相关命令的直接链接">​</a></h3><p><strong>Nginx 命令</strong></p><div class="language-bash codeBlockContainer_IW09 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Wktp"><pre tabindex="0" class="prism-code language-bash codeBlock_H6ch thin-scrollbar"><code class="codeBlockLines_j5Bm"><span class="token-line" style="color:#393A34"><span class="token plain">nginx -s reload  </span><span class="token comment" style="color:#999988;font-style:italic"># 向主进程发送信号，重新加载配置文件，热重启</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 一般在更新配置文件后需要重启</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx -s reopen  </span><span class="token comment" style="color:#999988;font-style:italic"># 重启 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Nginxnginx -s stop    </span><span class="token comment" style="color:#999988;font-style:italic"># 快速关闭</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx -s quit    </span><span class="token comment" style="color:#999988;font-style:italic"># 等待工作进程处理完成后关闭</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx -T         </span><span class="token comment" style="color:#999988;font-style:italic"># 查看当前 Nginx 最终的配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nginx -t         </span><span class="token comment" style="color:#999988;font-style:italic"># 检查配置是否有问题</span><br></span></code></pre><div class="buttonGroup_MKfy"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_t4q_" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_N8gI"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_InYZ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash codeBlockContainer_IW09 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Wktp"><pre tabindex="0" class="prism-code language-bash codeBlock_H6ch thin-scrollbar"><code class="codeBlockLines_j5Bm"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 开机配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> nginx </span><span class="token comment" style="color:#999988;font-style:italic"># 开机自动启动</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl disable nginx </span><span class="token comment" style="color:#999988;font-style:italic"># 关闭开机自动启动</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 启动 Nginx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start nginx </span><span class="token comment" style="color:#999988;font-style:italic"># 启动Nginx成功后，可以直接访问主机IP，此时会展示Nginx默认页面</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 停止 Nginx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl stop nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 重启 Nginx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 重新加载 Nginx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl reload nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看 Nginx 运行状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl status nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看 Nginx 进程</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> -ef </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> nginx</span><br></span></code></pre><div class="buttonGroup_MKfy"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_t4q_" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_N8gI"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_InYZ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="原理">原理<a href="#原理" class="hash-link" aria-label="原理的直接链接" title="原理的直接链接">​</a></h3><p><img loading="lazy" src="http://static.oschina.net/uploads/img/201406/02074942_yaSb.png" alt="img" class="img_SN3T"></p><p>nginx 的模块根据其功能基本上可以分为以下几种类型：</p><ul><li><strong>event module</strong>：搭建了独立于操作系统的事件处理机制的框架，及提供了各具体事件的处理。包括 ngx_events_module，  ngx_event_core_module 和 ngx_epoll_module 等。nginx 具体使用何种事件处理模块，这依赖于具体的操作系统和编译选项。</li><li><strong>phase handler</strong>：此类型的模块也被直接称为handler模块。主要负责处理客户端请求并产生待响应内容，比如 ngx_http_static_module 模块，负责客户端的静态页面请求处理并将对应的磁盘文件准备为响应内容输出。</li><li><strong>output filter</strong>：也称为filter模块，主要是负责对输出的内容进行处理，可以对输出进行修改。例如，可以实现对输出的所有 html 页面增加预定义的 footbar 一类的工作，或者对输出的图片的 URL 进行替换之类的工作。</li><li><strong>upstream</strong>：upstream模块实现反向代理的功能，将真正的请求转发到后端服务器上，并从后端服务器上读取响应，发回客户端。 upstream 模块是一种特殊的 handler，只不过响应内容不是真正由自己产生的，而是从后端服务器上读取的。</li><li><strong>load-balancer</strong>：负载均衡模块，实现特定的算法，在众多的后端服务器中，选择一个服务器出来作为某个请求的转发服务器。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="反向代理">反向代理<a href="#反向代理" class="hash-link" aria-label="反向代理的直接链接" title="反向代理的直接链接">​</a></h3><blockquote><p>如果遇到后盾集群的情况，再来查找反向代理相关资料，对笔记内容进行补充</p></blockquote><p>正向代理：用户进行请求的时候，将请求内容发送给代理（Proxy），然后代理（Proxy）负责进行请求。客户端进行服务的，客户端可以根据正向代理访问到它本身无法访问到的服务器资源。</p><p>我们<strong>知道请求的是代理</strong>，但是服务端不知道接收到的内容来自代理还是真实客户端。</p><p>反向代理（Reverse Porxy）指通过一个服务器接受客户端（Client）上面的请求，然后转发到内部网络的服务器（多个），并且将服务器上得到的结果返回给客户端（Client）。</p><p>我们并不知道自己访问的是代理服务器，而服务器知道反向代理在为他服务。因此反向代理用于以下目的</p><ul><li>隐藏真实服务器；</li><li>负载均衡便于横向扩充后端动态服务；</li><li>动静分离，提升系统健壮性，更容易维护；</li></ul><p>负载均衡策略</p><ul><li>轮询策略：将请求依次发送给不同的服务器</li><li>最小连接数策略：将请求优先发送给压力较小的服务器，避免向压力大的服务器多次请求</li><li>最快响应时间策略：优先分配给响应时间最短的服务器。</li><li>客户端 ip 绑定策略：同一个 ip 的请求永远只分配一台服务器，有效解决了动态网页存在的 session 共享问题。</li></ul><p><strong>负载均衡示例</strong></p><div class="language-nginx codeBlockContainer_IW09 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Wktp"><pre tabindex="0" class="prism-code language-nginx codeBlock_H6ch thin-scrollbar"><code class="codeBlockLines_j5Bm"><span class="token-line" style="color:#393A34"><span class="token plain">http {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  upstream product_server{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hash $request_uri; # 该内容表明，只要访问的 URI 保持不变，就会一直分发给同一台服务器。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 提供多个服务器的名称可以实现负载均衡（将同一个来源的请求分发到不同的服务器），weight 越高，分配的可能性越高</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.11:8880   weight=5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.12:9990   weight=1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.13:8989   weight=6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  upstream test_server{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    127.0.0.1:8083;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 默认指向 product 的 server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 会对访问地址进行解析，从上到下逐个匹配，匹配上就执行对应 location 大括号中的策略，并根据策略对请求作出相应。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      proxy_pass http://product_server;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location /product/{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      proxy_pass http://127.0.0.1:8081;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location /test/ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      proxy_pass http://test_server;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_MKfy"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_t4q_" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_N8gI"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_InYZ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 upstream 内可使用的指令：</p><ul><li>server 定义上游服务器地址；</li><li>zone 定义共享内存，用于跨 worker 子进程；</li><li>keepalive 对上游服务启用长连接；</li><li>keepalive_requests 一个长连接最多请求 HTTP 的个数；</li><li>keepalive_timeout 空闲情形下，一个长连接的超时时长；</li><li>hash 哈希负载均衡算法；</li><li>ip_hash 依据 IP 进行哈希计算的负载均衡算法；</li><li>least_conn 最少连接数负载均衡算法</li><li>least_time 最短响应时间负载均衡算法；</li><li>random 随机负载均衡算法；</li></ul><div class="language-nginx codeBlockContainer_IW09 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Wktp"><pre tabindex="0" class="prism-code language-nginx codeBlock_H6ch thin-scrollbar"><code class="codeBlockLines_j5Bm"><span class="token-line" style="color:#393A34"><span class="token plain">upstream server_example {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server address [parameters]  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_MKfy"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_t4q_" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_N8gI"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_InYZ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>parameters 可选值：</p><ul><li>weight=number 权重值，默认为1；</li><li>max_conns=number 上游服务器的最大并发连接数；</li><li>fail_timeout=time 服务器不可用的判定时间；</li><li>max_fails=numer 服务器不可用的检查次数；</li><li>backup 备份服务器，仅当其他服务器都不可用时才会启用；</li><li>down 标记服务器长期不可用，离线维护；</li></ul><h4 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="动静分离">动静分离<a href="#动静分离" class="hash-link" aria-label="动静分离的直接链接" title="动静分离的直接链接">​</a></h4><p>把不变的资源和经常变的资源区分开来，据静态资源的特点将其做缓存操作，这就是网站静态化处理的核心思路。</p><div class="language-nginx codeBlockContainer_IW09 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Wktp"><pre tabindex="0" class="prism-code language-nginx codeBlock_H6ch thin-scrollbar"><code class="codeBlockLines_j5Bm"><span class="token-line" style="color:#393A34"><span class="token plain">server {  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  listen 80;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server_name mingongge.com;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location /static {      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root /wwww/web/web_static_site; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_MKfy"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_t4q_" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_N8gI"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_InYZ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="对比-apache">对比 Apache<a href="#对比-apache" class="hash-link" aria-label="对比 Apache的直接链接" title="对比 Apache的直接链接">​</a></h3><p>Apache 为每一个请求，新建一个服务线程，过多的进程会耗尽内存从而使得机器使用磁盘上的交换内存，这严重的降低了性能。而且，当达到进程的上限之后，Apache 会拒绝新的连接。</p><p>如果一个线程停止了，用户会一直处于等待页面出现的状态，直到进程将该线程回收，以便可以发回页面。</p><p>Nginx 并不会为每一个的 web 请求创建新的进程，管理员可以配置 Nginx 主进程的工作进程（worker）的数量（一个常见的做法是为每一个CPU 配置一个工作进程）。每一个工作进程可以处理数千个并发的请求。它通过一个线程来异步的完成了这些工作，而没有使用多线程的编程模型。</p><p><strong>IO 多路复用</strong>和<strong>多线程</strong>的适用场景</p><p>IO 多路复用：一个线程，跟踪多个 socket 状态，哪个就绪，就读写哪个；</p><ul><li>单个请求处理速度没有优势，适合 IO 密集型场景，事件驱动</li><li>大并发量，只使用一个线程，处理大量并发请求，降低上下文环境切换损耗，不需要考虑并发问题，可以处理更多请求</li><li>消耗更少的系统资源（不需要线程调度开销）</li><li>适用于<strong>长连接</strong>的情况</li></ul><p>多线程：为每一个请求，新建一个服务线程</p><p>阻塞 IO + 多线程：实现简单，可以不依赖系统调用，适合 <strong>CPU 密集型</strong> 场景    </p><ul><li>每个线程，都需要时间和空间；</li><li>线程数量增长时，线程调度开销指数增长</li><li>多线程模式<strong>长连接</strong>容易造成线程过多，造成频繁调度</li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="默认配置">默认配置<a href="#默认配置" class="hash-link" aria-label="默认配置的直接链接" title="默认配置的直接链接">​</a></h2><p>可以到 官方配置网站 进行配置，然后将配置内容粘贴到配置文件中</p><p>nginxconfig</p><div class="language-nginx codeBlockContainer_IW09 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Wktp"><pre tabindex="0" class="prism-code language-nginx codeBlock_H6ch thin-scrollbar"><code class="codeBlockLines_j5Bm"><span class="token-line" style="color:#393A34"><span class="token plain">/etc/nginx/sites-available/mingongge.com.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#文件名都给你按规则配置好了</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  listen 443 ssl http2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server_name mingongge.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # SSL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ssl_certificate /etc/letsencrypt/live/mingongge.com/fullchain.pem;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ssl_certificate_key /etc/letsencrypt/live/mingongge.com/privkey.pem;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ssl_trusted_certificate /etc/letsencrypt/live/mingongge.com/chain.pem;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # security</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  include nginxconfig.io/security.conf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # additional config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  include nginxconfig.io/general.conf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># subdomains redirect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  listen 443 ssl http2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server_name *.mingongge.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # SSL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ssl_certificate /etc/letsencrypt/live/mingongge.com/fullchain.pem;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ssl_certificate_key /etc/letsencrypt/live/mingongge.com/privkey.pem;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ssl_trusted_certificate /etc/letsencrypt/live/mingongge.com/chain.pem;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return 301 https://mingongge.com$request_uri;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># HTTP redirect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  listen 80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server_name .mingongge.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  include nginxconfig.io/letsencrypt.conf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 301 https://mingongge.com$request_uri;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_MKfy"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_t4q_" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_N8gI"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_InYZ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="参考文章">参考文章<a href="#参考文章" class="hash-link" aria-label="参考文章的直接链接" title="参考文章的直接链接">​</a></h2><table><thead><tr><th>作者</th><th>文章名称</th></tr></thead><tbody><tr><td>民工哥</td><td><a href="https://segmentfault.com/a/1190000039873208" target="_blank" rel="noopener noreferrer">2W 字总结 ！体系化带你全面认识 Nginx</a></td></tr><tr><td>ningg</td><td><a href="http://ningg.top/nginx-series-principle/" target="_blank" rel="noopener noreferrer">Nginx 系列：Nginx 原理</a></td></tr><tr><td>yuezk 、几点人 、溪边九节</td><td><a href="https://www.oschina.net/translate/nginx-vs-apache" target="_blank" rel="noopener noreferrer">Nginx vs Apache（译）</a></td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/my-docs/Linux &amp; 操作系统/3-nginx.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_bGo0" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_OqbP"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/my-website/docs/Linux &amp; 操作系统/2.3-PowerShell"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">2.3-PowerShell</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/my-website/docs/Linux &amp; 操作系统/3.1-wsl"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">3.1-wsl</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_ZqNy thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#nginx" class="table-of-contents__link toc-highlight">Nginx</a><ul><li><a href="#应用场景" class="table-of-contents__link toc-highlight">应用场景</a></li><li><a href="#安装" class="table-of-contents__link toc-highlight">安装</a></li><li><a href="#配置文件" class="table-of-contents__link toc-highlight">配置文件</a></li><li><a href="#常用内置变量" class="table-of-contents__link toc-highlight">常用内置变量</a></li><li><a href="#相关命令" class="table-of-contents__link toc-highlight">相关命令</a></li><li><a href="#原理" class="table-of-contents__link toc-highlight">原理</a></li><li><a href="#反向代理" class="table-of-contents__link toc-highlight">反向代理</a></li><li><a href="#对比-apache" class="table-of-contents__link toc-highlight">对比 Apache</a></li></ul></li><li><a href="#默认配置" class="table-of-contents__link toc-highlight">默认配置</a></li><li><a href="#参考文章" class="table-of-contents__link toc-highlight">参考文章</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://juejin.cn/user/1565342280463325" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_GnfQ"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/Fall-zhang" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_GnfQ"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://segmentfault.com/u/fall_zhang0" target="_blank" rel="noopener noreferrer" class="footer__link-item">思否segmentfault<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_GnfQ"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">联系</div><ul class="footer__items clean-list"><li class="footer__item"><a href="#" class="footer__link-item">微信号：mymicrowings</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_GnfQ"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Fall. Built with Docusaurus.</div></div></div></footer></div>
<script src="/my-website/assets/js/runtime~main.81d456e9.js"></script>
<script src="/my-website/assets/js/main.572a1fc6.js"></script>
</body>
</html>