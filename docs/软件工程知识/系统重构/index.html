<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-软件工程知识/系统重构" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">系统重构 | Fall 的笔记本</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://fall-zhang.github.io/my-website/docs/软件工程知识/系统重构"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="系统重构 | Fall 的笔记本"><meta data-rh="true" name="description" content="Create by fall on 2022-01-30"><meta data-rh="true" property="og:description" content="Create by fall on 2022-01-30"><link data-rh="true" rel="icon" href="/my-website/./img/favicon.ico"><link data-rh="true" rel="canonical" href="https://fall-zhang.github.io/my-website/docs/软件工程知识/系统重构"><link data-rh="true" rel="alternate" href="https://fall-zhang.github.io/my-website/docs/软件工程知识/系统重构" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://fall-zhang.github.io/my-website/docs/软件工程知识/系统重构" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/my-website/blog/rss.xml" title="Fall 的笔记本 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/my-website/blog/atom.xml" title="Fall 的笔记本 Atom Feed"><link rel="stylesheet" href="/my-website/assets/css/styles.6cc54446.css">
<link rel="preload" href="/my-website/assets/js/runtime~main.81d456e9.js" as="script">
<link rel="preload" href="/my-website/assets/js/main.572a1fc6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_jwCO" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_duDI"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/my-website/"><div class="navbar__logo"><img src="/my-website/./img/logo.svg" alt="My Site Logo" class="themedImage_AzXg themedImage--light_gz6F"><img src="/my-website/./img/logo.svg" alt="My Site Logo" class="themedImage_AzXg themedImage--dark_wbl_"></div><b class="navbar__title text--truncate">Fall 的笔记本</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/my-website/docs/">笔记</a><a class="navbar__item navbar__link" href="/my-website/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Fall-zhang" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_GnfQ"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_drBT colorModeToggle_O6q4"><button class="clean-btn toggleButton_OBl4 toggleButtonDisabled_ne8F" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_eZza"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_Lxcj"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_mA0p"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_l8Aj docsWrapper_KAb6"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_WskB" type="button"></button><div class="docPage_kvSd"><aside class="theme-doc-sidebar-container docSidebarContainer_qwQk"><div class="sidebarViewport_uxQu"><div class="sidebar_uk_I sidebarWithHideableNavbar_roY8"><a tabindex="-1" class="sidebarLogo_B87G" href="/my-website/"><img src="/my-website/./img/logo.svg" alt="My Site Logo" class="themedImage_AzXg themedImage--light_gz6F"><img src="/my-website/./img/logo.svg" alt="My Site Logo" class="themedImage_AzXg themedImage--dark_wbl_"><b>Fall 的笔记本</b></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_l1ou"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/my-website/docs/">README</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/my-website/docs/category/javascript--typescript">JavaScript &amp; TypeScript</a><button aria-label="打开/收起侧边栏菜单「JavaScript &amp; TypeScript」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/my-website/docs/category/大前端知识点">大前端知识点</a><button aria-label="打开/收起侧边栏菜单「大前端知识点」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/HTML和CSS/-- BFC规范">HTML和CSS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/Linux &amp; 操作系统/1.1-linux">Linux &amp; 操作系统</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/React/-- Hooks">React</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/Vue/-- Vite FAQ">Vue</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/my-website/docs/git工具">git工具</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/npm 包/axios">npm 包</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/my-website/docs/npm 和 nvm 的使用">npm 和 nvm 的使用</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/其它语言/java/-- IDEA 的使用">其它语言</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/my-website/docs/前端环境搭建">前端环境搭建</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/后端/4.2-双向通信">后端</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/my-website/docs/学习资料">学习资料</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/数据库/-- linux环境下的使用">数据库</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/跨平台开发/1.1-移动端适配">跨平台开发</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/my-website/docs/软件工程知识/DevOps">软件工程知识</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/DevOps">DevOps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/Monorepo">Monorepo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/X-Y Problem">X-Y Problem</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/github指南">github指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/产品设计">产品设计</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/堆是什么？">堆是什么？</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/复杂度分析">复杂度分析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/开源许可证是什么">开源许可证是什么</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/拓扑排序">拓扑排序</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/数据结构">数据结构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/有向无环图">有向无环图</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/物联网技术的新可能">物联网技术的新可能</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/my-website/docs/软件工程知识/系统重构">系统重构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/组件开发">组件开发</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/计算机网络知识导图">计算机网络基础知识导图</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/设计模式">设计模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/软件架构">软件架构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/软件测试">软件测试</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/进程模型">进程模型</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/软件工程知识/面向切面编程">面向切面编程</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/my-website/docs/面试-自检/-- HTML、CSS知识点">面试-自检</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_Ia8V"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_YAfL"><div class="docItemContainer_UzBo"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_D4_C" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/my-website/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_SGKc"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">软件工程知识</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">系统重构</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_S2ie theme-doc-toc-mobile tocMobile_yUD8"><button type="button" class="clean-btn tocCollapsibleButton_NQ7N">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>系统重构</h1></header><blockquote><p>Create by <strong>fall</strong> on 2022-01-30
Recently revised in 2022-02-03</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="系统重构">系统重构<a href="#系统重构" class="hash-link" aria-label="系统重构的直接链接" title="系统重构的直接链接">​</a></h2><blockquote><p>软件开发成本 = 开发成本 + 维护成本；软件维护成本 = 软件理解成本 + 修改成本 + 测试成本 + 部署成本。 ——Kent Beck</p></blockquote><p>更新、迁移、重构、重写、重搭。</p><p>重写，规范代码，更新技术栈。</p><p>技术债管理由于重构。</p><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="为什么重构">为什么重构<a href="#为什么重构" class="hash-link" aria-label="为什么重构的直接链接" title="为什么重构的直接链接">​</a></h3><p>重构（名词）：对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本。
重构（动词）：使用一系列重构手法，在不改变软件可观察行为的前提下，调整期结构。</p><p>从这些定义来看，就是之前的系统特性（bug）也要保持该特性，然后让代码可读性变强。</p><blockquote><p>重构的唯一目的就是让我们开发更快，用更少的工作量创造更大的价值。。——《重构：改善既有代码的设计》</p></blockquote><p>重构就是为了钱，如果不能带来潜在的价值，就不要谈重构。</p><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="重构的动机">重构的动机<a href="#重构的动机" class="hash-link" aria-label="重构的动机的直接链接" title="重构的动机的直接链接">​</a></h3><ul><li>改善既有代码设计</li><li>帮助找到软件中的 bug（注意，不是修复，而是把出问题的代码找到）</li><li>提升开发效率</li><li>提高编程的趣味性——或许。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="重构不一定带来">重构不一定带来<a href="#重构不一定带来" class="hash-link" aria-label="重构不一定带来的直接链接" title="重构不一定带来的直接链接">​</a></h3><blockquote><p>重构的投入与回报并非呈现线性关系。——《领域驱动设计：软件核心复杂性对应之道》</p><p>毕竟味道越重的代码，相同的重构结果，也会提升更高。</p></blockquote><p>人们总倾向于认为能够带来：更少的代码；更稳定的系统，等等。。。</p><p>但是一般来讲，重构是这样的：</p><ul><li>我们拆分一个上帝类的时候，我们可能拆出了三四个类，因为那些 Import 、package、 type 的 declaration， 反而带来了更多的代码。</li><li>当我们发现重复代码，并且它们是可以被抽象的，那么我们就可以消去一般的代码。</li><li>如果我们在重构的过程中，发现 bug，那么系统必然会更加稳定。</li><li>如果因为我们重构，导致憋人合并代码时发生冲突，反而会带来 bug。</li><li>......</li></ul><p>尽管我们可能不会受益于所有重构的好处，但依然可以带来</p><ul><li><strong>编程的技艺</strong>。稳定的业务代码，便容易选择合理的识别设计模式。</li><li><strong>重构的手法</strong>。</li><li><strong>持续重构的意识</strong></li><li><strong>模式和原则</strong>。相似问题的处理使用相似的手法。</li><li><strong>抽象能力</strong>。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="大规模重构">大规模重构<a href="#大规模重构" class="hash-link" aria-label="大规模重构的直接链接" title="大规模重构的直接链接">​</a></h3><p>在接手别人或者别的新系统的代码，此时进行大规模重构。我们往往不被允许重构，并且如果业务人员说要重构的时候，系统可能不是重构那么简单，也许需要重写。</p><h2 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="系统重构模式与原则">系统重构模式与原则<a href="#系统重构模式与原则" class="hash-link" aria-label="系统重构模式与原则的直接链接" title="系统重构模式与原则的直接链接">​</a></h2><p>重构的基本原则</p><ul><li>小步前进。走一小步，提交一次代码，方便回滚。</li><li>随时可用。如果不能保证随时可用，那就说不上是重构了。（我理解的为，你重构一个功能后，能够继续使用）</li><li>融入日常。</li></ul><p>PDCA（Plan、Do、Check、Act）做出计划，实施计划，检查效果，纳入标准。不成功的作为下一轮去处理。作者在最前面加了个 E，evaluate（评估，识别需要重构的地方）</p><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="四级重构">四级重构<a href="#四级重构" class="hash-link" aria-label="四级重构的直接链接" title="四级重构的直接链接">​</a></h3><ul><li>架构重构。在不改变业务逻辑的情况下，根据单依职责和依赖倒置原则的思想：对系统进行模块拆分和合并，以明确职责，降低耦合度；对包进行重规划，划分包之间的便捷，减少代码的耦合。（用以明确不同业务包的作用）</li><li>模型重构。在包含测试的情况下，通过识别和发现模型的行为，将行为聚合到模型中：根基方法名，参数，返回判定内聚到模型中；从流程梳理是否符合业务场景。</li><li>模式重构。对于特定代码坏味道产生的问题。通过结合架构模式、设计模式来提升可读性。如使用工厂模式统一管理对象的创建；使用策略模式降低复杂度。</li><li>代码重构。对于一些小的代码坏味道，可以通过 IDE 重构来快速改善既有代码，而不会影响到业务功能。复杂条件语句的提取，使用参数对象冲狗狗参数过多。</li></ul><blockquote><p>小步前进：每隔几十行代码（同一个逻辑），随时提交，以及同步代码，方便回滚</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="人员评估">人员评估<a href="#人员评估" class="hash-link" aria-label="人员评估的直接链接" title="人员评估的直接链接">​</a></h3><ul><li>确保有足够的能力</li><li>确保对于重构有共同的看法</li><li>确保彼此能配合工作</li></ul><p>并且具备以下技能：</p><ul><li>理解面向对象设计</li><li>了解设计模式</li><li>了解测试的重要性</li><li>了解为什么要重构</li><li>追求代码质量</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="重构范围">重构范围<a href="#重构范围" class="hash-link" aria-label="重构范围的直接链接" title="重构范围的直接链接">​</a></h3><p>对于庞大的系统来说，每一部分的价值并非相等。</p><p>对于系统的核心，为它分配最好的开发人员，对于支撑部分来说，分配少量核心开发人员，确保工作能够按时完成。</p><p>按照 DDD 的思想来看，就是核心域，支撑域，通用域的区别。</p><h2 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="重构评估与度量">重构评估与度量<a href="#重构评估与度量" class="hash-link" aria-label="重构评估与度量的直接链接" title="重构评估与度量的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="技术债务">技术债务<a href="#技术债务" class="hash-link" aria-label="技术债务的直接链接" title="技术债务的直接链接">​</a></h3><blockquote><p>对于技术债，利息表现在系统的不稳定性，以及由于临时性手段和缺乏合适的设计、文档工作和测试带来的不断攀升的维护成本。—— 《软件架构师应该知道的 97 件事》</p></blockquote><p>不可见（可维护性，可演进性两个方面）：</p><ul><li>架构：<ul><li>架构坏味道</li><li>反模式</li><li>复杂的结构</li></ul></li><li>代码：<ul><li>内部质量低下</li><li>代码复杂</li><li>代码花味道</li><li>违反编程风格</li></ul></li><li>其他开发制品：<ul><li>测试和文档的问题</li></ul></li></ul><p>可见问题：</p><ul><li>可演进性：<ul><li>新功能（新增功能）</li></ul></li><li>可维护性：<ul><li>bug（缺陷）</li><li>外部质量低下</li></ul></li></ul><p>借助 Tequila 架构可视化工具，可以得到项目的调用关系图，某种层面上反映出系统的架构</p><ul><li>项目的结构划分是否合理</li><li>项目中的代码是否存在循环依赖的情况</li></ul><blockquote><p>如何找到技术债务的位置？</p><p>收集代码坏味道，<code>coca bs</code>。</p><p>Todo 一般 todo表示应该去做的事，但是没有立刻去做，这些事可能就是项目中的技术债务。</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="重构准入条件">重构准入条件<a href="#重构准入条件" class="hash-link" aria-label="重构准入条件的直接链接" title="重构准入条件的直接链接">​</a></h3><ul><li>工具准备</li><li>重构看板</li><li>版本控制</li><li>自动化构建工具</li><li>持续集成环境</li><li>记录</li><li>探索性重构：可行方案</li><li>准备知识：坏味道模式</li></ul><blockquote><p>重构：改善既有代码的设计中提出的23种代码坏味道</p><ul><li>代码臃肿。过长函数，过大的类，基本类型偏执，过长参数列，数据泥团</li><li>滥用面向对象。Switch 声明，临时字段，被拒绝的遗赠，异曲同工的类</li><li>变革的障碍。发散式变化，散弹式修改，平行继承体系。</li><li>非必要的。冗余类，纯稚的数据类型，重复代码，注释，没有使用的未来特性。</li><li>耦合。不完美的类库，依恋情节，消息链，中间人</li></ul></blockquote><blockquote><p>C4模型：System、Container、Component、Code 四个层次，由顶部到底部介绍系统的架构。</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="探索模式">探索模式<a href="#探索模式" class="hash-link" aria-label="探索模式的直接链接" title="探索模式的直接链接">​</a></h3><p><strong>从分层架构到具体代码</strong></p><ul><li>代码库关系</li><li>代码库内模块化结构</li><li>模块化包的结构</li><li>包内代码结构</li></ul><p><strong>从外部适配器到内部适配器</strong></p><ul><li>是否包含单元测试</li><li>是否包含集成测试</li><li>测试覆盖率情况</li><li>测试编写情况</li></ul><p><strong>最复杂的情形和最简单的情形</strong></p><ul><li>从最简单的场景出发，对常规流程，包间关系有一定的了解</li><li>从复杂的场景收尾，看最复杂的场景下会有什么问题</li><li>根据需要寻找一个适合的场景。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="寻找高引用和修改">寻找高引用和修改<a href="#寻找高引用和修改" class="hash-link" aria-label="寻找高引用和修改的直接链接" title="寻找高引用和修改的直接链接">​</a></h3><p>识别高修改的文件，用来查看文件的修改次数，如果是上帝类经常进行修改，说明文件经常出现问题。重构着重考虑。</p><h2 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="系统架构重构">系统架构重构<a href="#系统架构重构" class="hash-link" aria-label="系统架构重构的直接链接" title="系统架构重构的直接链接">​</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="防护网">防护网<a href="#防护网" class="hash-link" aria-label="防护网的直接链接" title="防护网的直接链接">​</a></h3><p>重构不影响 API 的使用方，我们需要设计合适的防护策略。</p><p><strong>检视测试</strong>（表明测试中的问题，测试代码坏味道）</p><ul><li>空的测试。测试是生成的，但是没有内容。</li><li>忽略的测试。测试被 ignore</li><li>没有断言的测试。为了提高测试覆盖率而出现的测试。</li><li>多余的 PrintIn。调试时留下的信息。</li><li>多重断言，每个测试函数只应该测试一个概念。</li></ul><blockquote><p>架构将大问题分解为容易处理的小问题。——《架构师修炼之道 》</p></blockquote><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="重量级重构">重量级重构<a href="#重量级重构" class="hash-link" aria-label="重量级重构的直接链接" title="重量级重构的直接链接">​</a></h3><p><strong>重量级</strong>重构，意味着重构时需要有：</p><ul><li>积极专注的团队参与</li><li>复杂的场景</li><li>领域专家的协助</li><li>迭代式的模型设计</li></ul><p>为此，之前需要进行</p><ul><li>事件风暴</li><li>识别上下文，梳理上下文关系</li><li>划分问题子域</li><li>识别弹性边界</li><li>领域建模</li><li>分层架构</li></ul><p>实现时，需要：</p><ul><li>重搭架构</li><li>编写集成测试</li><li>搬移代码</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="轻量级重构">轻量级重构<a href="#轻量级重构" class="hash-link" aria-label="轻量级重构的直接链接" title="轻量级重构的直接链接">​</a></h3><ul><li>结合工具识别出所有的接口</li><li>通过接口识别出领域名词（聚合、实体）</li><li>分析接口设计是否合理</li><li>通过领域名词划分上下文边界</li><li>重新定义领域名词</li><li>结合领域名词划分新的 API</li><li>划分领域和分层架构</li><li>重新划分分层架构</li><li>重构 service 代码，剥离领域逻辑</li><li>重构代码到领域模型</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="限界上下文要素">限界上下文要素<a href="#限界上下文要素" class="hash-link" aria-label="限界上下文要素的直接链接" title="限界上下文要素的直接链接">​</a></h3><ul><li>实体（entity）。只要一个对象在生命周期中能够保持连续性，并且独立于它的属性（即：使这些属性对系统用户非常重要），那它就是一个实体。具有唯一标识和生命周期。</li><li>值对象（value object）。当你只关心某个对象的属性时，该对象便可作为一个值对象。它是实体的附加业务概念，用来描述实体所包含的业务信息。</li><li>领域服务（domain service）。封装了没有在模型中自检建模为值对象或实体的领域逻辑概念。职责是使用实现和值对象编排业务逻辑。</li><li>领域事件（domain event）。他用于表明问题域中发生了一些业务人员关心的事情。在明明领域事件时，我们往往选择动词的过去分词，已明确表达事件的属性，（XXX 已经 YYY）</li><li>资源库（repository）。公开聚合根在内存中的集合的接口，提供聚合根的检索和持久化需要。</li><li>工厂（factory）。即在实体或者值对象创建复杂时，可以委托给工厂（模式）进行创建。</li><li>聚合（aggregate）。一种边界内的领域对象集群，可以将其视为一个单元。可以封装一个到多个实体与值对象，用来维护该边界范围之内的业务完整性。</li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="微服务重构">微服务重构<a href="#微服务重构" class="hash-link" aria-label="微服务重构的直接链接" title="微服务重构的直接链接">​</a></h3><p>一旦涉及到对微服务进行重构，有很大的可能性要对系统进行 API 的重构设计。我们可能会影响到API的使用方，如果使用方是第三方团队的时候，我们就要考虑一下兼容使用方案。这种兼容方案会影响我们的重构。</p><p>微服务是一个生态系统，它需要大量的基础设施进行配合，如部署管道、服务注册与发现，日志和监控，负载均衡。</p><blockquote><p>该文章笔者对微服务重构也不精，敬请期待我的下一次更新！</p></blockquote><h2 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="服务架构重构">服务架构重构<a href="#服务架构重构" class="hash-link" aria-label="服务架构重构的直接链接" title="服务架构重构的直接链接">​</a></h2><p>（容器架构重构）</p><p>Robert C. Martin 总结了六边形架构（即端口与适配器架构）、DCI  （Data-Context-Interactions，数据-场景-交互）架构、BCI（Boundary Control  Entity，Boundary Control Entity）架构等多种架构，归纳出了这些架构的基本特点：</p><ul><li>框架无关性。不依赖于框架中的某一个函数，框架只是一个工具，系统不能，不去适应框架。</li><li>可被测试。业务逻辑脱离于 UI、数据库等外部元素进行测试。</li><li>UI 无关性。不需要修改系统的其它部分，就可以变更 UI，诸如由 Web 界面替换成 CLI。</li><li>数据库无关性。业务逻辑与数据库之间需要进行解耦，我们可以随意切换LocalStorage、IndexedDB、Web SQL</li><li>外部机构（agency）无关性。系统的业务逻辑，不需要知道其它外部接口，诸如安全、调度、代理。</li></ul><hr><p> <em>这段不怎么会</em></p><p><strong>实体（Entities）</strong>，实体用于封装企业范围的业务规则。实体可以是拥有方法的对象，也可以是数据结构和函数的集合。如果没有企业，只是单个应用，那么实体就是应用里的业务对象。这些对象封装了最通用和高层的业务规则，极少会受到外部变化的影响。任何操作层面的改动都不会影响到这一层。</p><p><strong>用例（Use Cases）</strong>，用例是特定于应用的业务逻辑，一般用来完成用户的某个操作。用例协调数据流向或者流出实体层，并且在此过程中通过执行实体的业务规则来达成用例的目标。用例层的改动不会影响到内部的实体层，同时也不会受外层的改动影响，比如数据库、UI 和框架的变动。只有而且应当应用的操作发生变化的时候，用例层的代码才随之修改。</p><p><strong>接口适配器（Interface Adapters）</strong>。接口适配器层的主要作用是转换数据，数据从最适合内部用例层和实体层的结构转换成适合外层（比如数据持久化框架）的结构。反之，来自于外部服务的数据也会在这层转换为内层需要的结构。</p><p><strong>框架和驱动（Frameworks and Drivers）</strong>。最外层由各种框架和工具组成，比如 Web 框架、数据库访问工具等。通常在这层不需要写太多代码，大多是一些用来跟内层通信的胶水代码。这一层包含了所有实现细节，把实现细节锁定在这一层能够减少它们的改动对整个系统造成的伤害。</p><h3 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="真的是util">真的是util？<a href="#真的是util" class="hash-link" aria-label="真的是util？的直接链接" title="真的是util？的直接链接">​</a></h3><p>往往会向 util 内添加逻辑，正如会忘 common/bean 中扔入所有的 model</p><table><thead><tr><th>阶段</th><th>解释</th><th>示例</th></tr></thead><tbody><tr><td>空白</td><td>没有名称</td><td>doSomething()</td></tr><tr><td>凑合</td><td>名称不能准确反应元素的含义</td><td>preload()</td></tr><tr><td>沾边</td><td>名称至少反映了元素某一方面的功能</td><td>DomSomethingEvilToDB()</td></tr><tr><td>反映功能</td><td>名称直接描述了元素的所有功能</td><td>ParseXmlAndStoreFightToDbAndLocalCacheAndStartProcessing()</td></tr><tr><td>反映角色</td><td>名称充分地反映了元素在架构中的角色</td><td>StoreFightlightToDatabaseAndStartProcessing</td></tr><tr><td>反映意图</td><td>名称不仅反映元素的功能，还能反映其目的。</td><td>BeginTrackingFlight()</td></tr><tr><td>领域抽象</td><td>名称超越了单个元素本身，成为一个新的抽象概念。</td><td>MonitoringPanle.Add(new Flight())</td></tr></tbody></table><h2 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="参考文章">参考文章<a href="#参考文章" class="hash-link" aria-label="参考文章的直接链接" title="参考文章的直接链接">​</a></h2><table><thead><tr><th>名称</th><th>链接</th></tr></thead><tbody><tr><td>系统重构</td><td><a href="https://migration.ink/" target="_blank" rel="noopener noreferrer">https://migration.ink/</a></td></tr></tbody></table><h2 class="anchor anchorWithHideOnScrollNavbar_Lz3K" id="相关链接">相关链接<a href="#相关链接" class="hash-link" aria-label="相关链接的直接链接" title="相关链接的直接链接">​</a></h2><table><thead><tr><th>文章名称</th><th>链接</th></tr></thead><tbody><tr><td>分层架构重构</td><td><a href="https://www.phodal.com/blog/refactor-mvc-architecture-to-ddd/" target="_blank" rel="noopener noreferrer">https://www.phodal.com/blog/refactor-mvc-architecture-to-ddd/</a></td></tr><tr><td>构建可信软件系统</td><td><a href="https://www.phodal.com/blog/build-trusted-software-system/" target="_blank" rel="noopener noreferrer">https://www.phodal.com/blog/build-trusted-software-system/</a></td></tr><tr><td>测试代码的坏味道</td><td><a href="https://www.phodal.com/blog/test-bad-smell/" target="_blank" rel="noopener noreferrer">https://www.phodal.com/blog/test-bad-smell/</a></td></tr><tr><td>技术债治理的四条原则</td><td><a href="https://insights.thoughtworks.cn/managing-technical-debt/" target="_blank" rel="noopener noreferrer">https://insights.thoughtworks.cn/managing-technical-debt/</a></td></tr></tbody></table><p>技术债治理的四条原则：</p><ul><li>核心领域优先</li><li>可演进性优于可维护性</li><li>明确清晰地责任定义优于松散无序的任务分配</li><li>主动预防优于被动响应</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/my-docs/软件工程知识/系统重构.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_bGo0" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_OqbP"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/my-website/docs/软件工程知识/物联网技术的新可能"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">物联网技术的新可能</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/my-website/docs/软件工程知识/组件开发"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">组件开发</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_ZqNy thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#系统重构" class="table-of-contents__link toc-highlight">系统重构</a><ul><li><a href="#为什么重构" class="table-of-contents__link toc-highlight">为什么重构</a></li><li><a href="#重构的动机" class="table-of-contents__link toc-highlight">重构的动机</a></li><li><a href="#重构不一定带来" class="table-of-contents__link toc-highlight">重构不一定带来</a></li><li><a href="#大规模重构" class="table-of-contents__link toc-highlight">大规模重构</a></li></ul></li><li><a href="#系统重构模式与原则" class="table-of-contents__link toc-highlight">系统重构模式与原则</a><ul><li><a href="#四级重构" class="table-of-contents__link toc-highlight">四级重构</a></li><li><a href="#人员评估" class="table-of-contents__link toc-highlight">人员评估</a></li><li><a href="#重构范围" class="table-of-contents__link toc-highlight">重构范围</a></li></ul></li><li><a href="#重构评估与度量" class="table-of-contents__link toc-highlight">重构评估与度量</a><ul><li><a href="#技术债务" class="table-of-contents__link toc-highlight">技术债务</a></li><li><a href="#重构准入条件" class="table-of-contents__link toc-highlight">重构准入条件</a></li><li><a href="#探索模式" class="table-of-contents__link toc-highlight">探索模式</a></li><li><a href="#寻找高引用和修改" class="table-of-contents__link toc-highlight">寻找高引用和修改</a></li></ul></li><li><a href="#系统架构重构" class="table-of-contents__link toc-highlight">系统架构重构</a><ul><li><a href="#防护网" class="table-of-contents__link toc-highlight">防护网</a></li><li><a href="#重量级重构" class="table-of-contents__link toc-highlight">重量级重构</a></li><li><a href="#轻量级重构" class="table-of-contents__link toc-highlight">轻量级重构</a></li><li><a href="#限界上下文要素" class="table-of-contents__link toc-highlight">限界上下文要素</a></li><li><a href="#微服务重构" class="table-of-contents__link toc-highlight">微服务重构</a></li></ul></li><li><a href="#服务架构重构" class="table-of-contents__link toc-highlight">服务架构重构</a><ul><li><a href="#真的是util" class="table-of-contents__link toc-highlight">真的是util？</a></li></ul></li><li><a href="#参考文章" class="table-of-contents__link toc-highlight">参考文章</a></li><li><a href="#相关链接" class="table-of-contents__link toc-highlight">相关链接</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://juejin.cn/user/1565342280463325" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_GnfQ"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/Fall-zhang" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_GnfQ"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://segmentfault.com/u/fall_zhang0" target="_blank" rel="noopener noreferrer" class="footer__link-item">思否segmentfault<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_GnfQ"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">联系</div><ul class="footer__items clean-list"><li class="footer__item"><a href="#" class="footer__link-item">微信号：mymicrowings</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_GnfQ"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Fall. Built with Docusaurus.</div></div></div></footer></div>
<script src="/my-website/assets/js/runtime~main.81d456e9.js"></script>
<script src="/my-website/assets/js/main.572a1fc6.js"></script>
</body>
</html>