---
sidebar_position: 3
---

> Create by **fall** on 09 Jun 2022
> Recently revised in 04 Apr 2023

## 移动端适配

在移动端虽然整体来说大部分浏览器内核都是 webkit，而且大部分都支持 css3 的所有语法。但是，由于手机屏幕尺寸不一样，分辨率不一样，或者你需要考虑横竖屏的问题，或者考虑到各式各样的移动端兼容性问题。

### 像素大小

设备像素（设备分辨率）：手机的物理像素分辨率，和显示器有关，设备像素和设备分辨率由操作系统控制并管理。

逻辑分辨率（设备独立像素、逻辑像素）：逻辑分辨率用屏幕的 `width * height` 来表示（单位：设备独立像素）

CSS 像素：不会随着设备的变化而变化，是固定的，如果进行放大，放大的是 CSS展示比例，像素大小不会随之改变。

> 屏幕的设备分辨率是 `1920*1200`（单位：设备像素）我们可以在当前的分辨率下设置逻辑分辨率是`1280*800`（单位：设备独立像素）

**css 像素与设备独立像素的关系**

在缩放比例为 100% 的情况下，1 个 css 像素大小等于 `1*1` 个设备独立像素；缩放比例为 200% 的情况下，1 css 像素等于 `2*2` 个像素。

**css 像素与设备像素的关系**

`window.devicePixelRatio` 获取设备像素比（同一直线上，设备像素的数量 / CSS 像素的数量）。

如果 devicePixelRatio = 2，表示设备像素的数量是 CSS 像素数量的 2 倍

### viewport

layout viewport：布局窗口，即 `html` 元素的父容器，有时会无法展示出 `layout viewport` 全貌，但数据确实加载上了，这时候会出现滚动条

visual viewport：视觉窗口，显示出 layout viewport 的那一部分。

ideal viewport：理想视口，最适合移动设备的 viewport。只要在 css 中把某一元素的宽度设为 ideal viewport 的宽度(单位用 px )，那么这个元素的宽度就是设备屏幕的宽度了，也就是宽度为100% 的效果。 

对 viewport 进行控制

```html
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<!-- 该 meta 标签的作用是让当前 viewport 的宽度等于设备的宽度，同时不允许用户手动缩放。 -->
```

| 属性          | 值                                                           |
| ------------- | ------------------------------------------------------------ |
| initial-scale | 允许用户的最小缩放值，为一个数字，可以带小数                 |
| minimum-scale | 允许用户的最大缩放值，为一个数字，可以带小数                 |
| user-scalable | 是否允许用户进行缩放，值为"no"或"yes", no 代表不允许，yes 代表允许 |

## 适配方案

### media

`@media` 页面上所有的元素都得在不同的 `@media` 中定义一遍不同的尺寸

```css
@media only screen and (min-width: 375px) {
  .logo {width : 62.5px;}
}
@media only screen and (min-width: 360px) {
  .logo {width : 60px;}
}
@media only screen and (min-width: 320px) {
  .logo {    width : 53.3333px;  }
}
```

### rem

rem（font size of the root element）根元素的字体大小，如果设置 html 字体大小为 16px 之后，只需设置字体为 1rem 即可，虽然仍需要 `@media` 为不同大小的设备进行设置，但减少了很多操作。

```css
@media only screen and (min-width: 375px) {
  html {    font-size : 375px;}
}
@media only screen and (min-width: 360px) {
  html {font-size : 360px;}
}
//定义方法：calc
@function calc($val){
  @return $val / 1080;
}
.logo{
  width : calc(180rem);
}
```

### flexible

使用 js 动态来设置根字体

```js
// set 1rem = viewWidth / 10
function setRemUnit () {
    var rem = docEl.clientWidth / 10
    docEl.style.fontSize = rem + 'px'
}
setRemUnit();
```

由于其缩放的缘故，video 标签的视频频播放器的样式在不同 dpr 的设备上展示差异很大；

### viewport

因为每个屏幕的百分比是固定的、可预测、可控制的。

- `vw`：是 viewport's width 的简写，1vw 等于 `window.innerWidth` 的 1%；
- `vh`：是 viewport's height 的简写，1vh 等于 `window.innerHeihgt` 的 1%；
- `vmin`、`vmax`：`vmin` 的值是当前 `window.innerWidth` 和 `window.innerWidth` 中较小的值，vmax 的值是较大的值

利用 PostCSS 减少计算，自动将 px 计算为 vw

```bash
npm install postcss-px-to-viewport --save-dev
```

因为会自动进行转换，当不需要转换时，使用下面的注释

```css
.class {
  /* px-to-viewport-ignore-next */
  width: 10px;
  padding: 10px;
  height: 10px; /* px-to-viewport-ignore */
}
```

会解析如下内容

```css
.class {
  width: 10px; 
  padding: 3.125vw;
  height: 10px;
}
```

Retina （视网膜屏）屏场景，可能对图片的高清程度、1px 等场景有需求，所以我们预留判断 Retina 屏坑位。

```js
// index.html 文件
const dpr = devicePixelRatio >= 3? 3: devicePixelRatio >= 2? 2: 1;
document.documentElement.setAttribute('data-dpr', dpr);
```

### 控制viewport

移动端直接控制 meta 中的 content 描述即可控制 viewport

```html
<meta id="vp" name="viewport" content="width=750,initial-scale=0.5,maximum-scale=0.5,minimum-scale=0.5,user-scalable=no">
<script>
var w1=window.innerWidth,scale=w1/750*0.5;
document.getElementById('vp').content='width=750,initial-scale='+scale+',maximum-scale='+scale+',minimum-scale='+scale+',user-scalable=no';
</script>
```



## 常见问题

### 1px

我们直接写 css 的大小 1px，那在 dpr = 2 时，则等于 2px 设备像素，dpr = 3 时，等于 3px 设备像素。

**解决方案：**

```css
.calss1 {
  position: relative;
  &::after {
    content:"";
    position: absolute;
    bottom:0px;
    left:0px;
    right:0px;
    border-top:1px solid #666;
    transform: scaleY(0.5);
  }
}
```

### 图片不清晰

普通屏幕的图片在视网膜屏幕下，会出现模糊的情况，

如果全部应用高清图，浪费带宽，如果全部应用普通图，无法保证清晰，通过下面的方法实现适配

```scss
[data-dpr="1"] .hello {
  background-image: url(image@1x.jpg);
[data-dpr="2"] .hello {
  background-image: url(image@2x.jpg);
}
[data-dpr="3"] .hello {
  background-image: url(image@3x.jpg);
}
```

### 安全区域

比如说因为曲面屏，因为屏幕下方的一条导航栏，导致最下方的数据和菜单被遮挡，所以采用安全区域，进行设置margin

iphone 的 meta 标签中，viewport添加了新的内容，可设置三个值

- contain：可视窗口完全包含网页内容
- cover：网页内容完全覆盖可视窗口
- auto：默认值，跟 contain 表现一致

## 插件

一般来讲，插件都是 postcss 插件，来处理 css

### postcss-pxtorem

```bash
npm install postcss-pxtorem --save
```

vue 项目中，通过 `vue.config.js` 中添加以下内容，对该插件进行配置

```js
const postToRem = require('postcss-pxtorem')({ // 把px单位换算成rem单位
  rootValue: 16, // 初始根元素大小（换算基数） 
  unitPrecision: 3, //允许 REM 单位增长到的十进制数字，小数点后保留的位数。
  propList: ['*'], // 需要从 px 转化为 rem 的属性，如：height,font-size 之类，或者通配符 *
  exclude: /(node_module)/,
  selectorBlackList: ['.van'],// 选择器白名单
  mediaQuery: false,  // 是否允许在 f12 查询中转换px，默认为false。
  minPixelValue: 1 //设置要替换的最小像素值
})
module.exports={
  css: {
    loaderOptions: {
      postcss: {
        plugins: [postToRem]
      }
    }
  }
}
```

### 随窗口变化

```js
// 基准大小
const baseSize = 37.5
// 设置 rem 函数
function setRem () {
  // 当前页面宽度相对于 750 宽的缩放比例，可根据自己需要修改。
  const scale = document.documentElement.clientWidth / 750
  // 设置页面根节点字体大小
  document.documentElement.style.fontSize = (baseSize * Math.min(scale, 2)) + 'px'
}
// 初始化
setRem()
// 改变窗口大小时重新设置 rem
window.onresize = function () {
  setRem()
}
```





## 参考文章

| 作者             | 链接                                       |
| ---------------- | ------------------------------------------ |
| 我是你的超级英雄 | https://juejin.cn/post/7046169975706353701 |
| MK麦客           | https://juejin.cn/post/7096367751626752008 |

